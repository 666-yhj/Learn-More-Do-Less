#从zookeeper到分布式

-------------

> zookeeper作为分布式服务的协调组件，越来越多的分布式服务都使用zk作为配置中心，负载均衡，以及分布式锁，主节点选举等。那么zk是如何解决在分布式情况出现的问题。就值得研究

* 分布式
  * 特点
    1. 分布性：程序部署的机器在时间和空间上存在随机性
    2. 并发性：对于同一个服务存在同时访问同时修改的情况
    3. 无序性：进程之间的消息通讯可能会出现顺序不一致
  * 问题
    1. 网络通讯：网络本身的不可靠导致通讯出现故障
    2. 网络分区：网络发生异常时只有部分节点能够通信
    3. 三态：除了普通的成功，失败，还有超时
    4. 分布式事务：对事物的控制
* cap理论
  * 在分布式系统中，不能同时满足Consistency(一致性)，Availability(可用性)，Partition tolerance(分区容错性)这三个基本需求，最多只能满足其中的两项。
* base理论
  * base理论是指，basically available(基本了用)，soft-state(软状态/柔性事物)，eventual consistency(最终一致性)。是基于cap定理演化而来。是对于cap中一致性和可用性权衡的结果。
* 一致性
  * 强一致性(ACID)
  * 弱一致性
  * 最终一致性(一段时间达到一致性)
    * 分布式情况下的特点出现的问题会导致最终一致性的失败因此不同的应用采用了不同的解决方案
      1. 2pc:通过引入tm来管理ap。在第一阶段tm向ap发送事物内容，进行事物的执行和反馈tm。在第二阶段tm接收到反馈之后进行提交事务或者回滚事务的操作。
         * 问题：同步阻塞，tm挂掉，以及一个ap没有回应则要回滚全部。
      2. 3pc：是在2pc的基础上进行改进的，将2pc的二阶段拆分成了两个阶段预提交阶段和提交阶段。减少了同步阻塞的时间，并加入了超时机制。
         * 问题：数据不一致问题。
      3. paxos
         1. 阶段1：由
* zab协议